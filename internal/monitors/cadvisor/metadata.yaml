- &cadvisor
  dimensions:
  - description: The ID of the running container
    name: container_id
  - description: The container image name
    name: container_image
  - description: The container's name as it appears in the pod spec, the same as container_spec_name
      but retained for backwards compatibility.
    name: container_name
  - description: The container's name as it appears in the pod spec
    name: container_spec_name
  - description: The K8s namespace the container is part of
    name: kubernetes_namespace
  - description: The pod instance under which this container runs
    name: kubernetes_pod_name
  - description: The UID of the pod instance under which this container runs
    name: kubernetes_pod_uid
  doc: |
    This monitor pulls metrics directly from cadvisor, which
    conventionally runs on port 4194, but can be configured to anything.  If you
    are running on Kubernetes, consider the [kubelet-stats](./kubelet-stats.md)
    monitor because many K8s nodes do not expose cAdvisor on a network port,
    even though they are running it within Kubelet.

    If you are running containers with Docker, there is a fair amount of
    duplication with the `collectd/docker` monitor in terms of the metrics sent
    (under distinct metric names) so you may want to consider not enabling the
    Docker monitor in a K8s environment, or else use filtering to whitelist only
    certain metrics.  Note that this will cause the built-in Docker dashboards
    to be blank, but container metrics will be available on the Kubernetes
    dashboards instead.
  groups:
  - name: container-cpu
    description:
  - name: container-cpu-spec
    description:
  - name: container-mem
    description:
  - name: container-mem-spec
    description:
  - name: container-fs
    description:
  - name: pods
    description:
  - name: machines
    description:
  metrics:
  # Container CPU
  - description: Total number of elapsed CFS enforcement intervals
    group: container-cpu
    included: false
    name: container_cpu_cfs_periods
    type: counter
  - description: Total number of times tasks in the cgroup have been throttled
    group: container-cpu
    included: false
    name: container_cpu_cfs_throttled_periods
    type: counter
  - description: Total time duration, in nanoseconds, for which tasks in the cgroup
      have been throttled
    group: container-cpu
    included: false
    name: container_cpu_cfs_throttled_time
    type: counter
  - description: Cumulative cpu utilization as a percentage of the total host CPU
      available.  This metric is equivalent to `container_cpu_utilization` / <# of
      CPUs/cores on host>.
    group: container-cpu
    included: false
    name: container_cpu_percent
    type: counter
  - description: Cumulative system cpu time consumed in nanoseconds
    group: container-cpu
    included: false
    name: container_cpu_system_seconds_total
    type: counter
  - description: Cumulative cpu time consumed per cpu in nanoseconds
    group: container-cpu
    included: false
    name: container_cpu_usage_seconds_total
    type: counter
  - description: Cumulative user cpu time consumed in nanoseconds
    group: container-cpu
    included: false
    name: container_cpu_user_seconds_total
    type: counter
  - description: 'Cumulative cpu utilization in percentages.  This is equivalent to
      "centicores", or hundreths of CPU cores consumed.  This metric is **NOT** normalized
      by the total # of cores on the system.'
    group: container-cpu
    included: true
    name: container_cpu_utilization
    type: counter

  # Container FS
  - description: Number of I/Os currently in progress
    group: container-fs
    included: false
    name: container_fs_io_current
    type: gauge
  - description: Cumulative count of seconds spent doing I/Os
    group: container-fs
    included: false
    name: container_fs_io_time_seconds_total
    type: counter
  - description: Cumulative weighted I/O time in seconds
    group: container-fs
    included: false
    name: container_fs_io_time_weighted_seconds_total
    type: counter
  - description: Number of bytes that the container may occupy on this filesystem
    group: container-fs
    included: false
    name: container_fs_limit_bytes
    type: gauge
  - description: Cumulative count of seconds spent reading
    group: container-fs
    included: false
    name: container_fs_read_seconds_total
    type: counter
  - description: Cumulative count of reads merged
    group: container-fs
    included: false
    name: container_fs_reads_merged_total
    type: counter
  - description: Cumulative count of reads completed
    group: container-fs
    included: false
    name: container_fs_reads_total
    type: counter
  - description: Cumulative count of sector reads completed
    group: container-fs
    included: false
    name: container_fs_sector_reads_total
    type: counter
  - description: Cumulative count of sector writes completed
    group: container-fs
    included: false
    name: container_fs_sector_writes_total
    type: counter
  - description: Number of bytes that are consumed by the container on this filesystem
    group: container-fs
    included: false
    name: container_fs_usage_bytes
    type: gauge
  - description: Cumulative count of seconds spent writing
    group: container-fs
    included: false
    name: container_fs_write_seconds_total
    type: counter
  - description: Cumulative count of writes merged
    group: container-fs
    included: false
    name: container_fs_writes_merged_total
    type: counter
  - description: Cumulative count of writes completed
    group: container-fs
    included: false
    name: container_fs_writes_total
    type: counter

  # Container Memory
  - description: Number of memory usage hits limits
    group: container-mem
    included: false
    name: container_memory_failcnt
    type: counter
  - description: Cumulative count of memory allocation failures
    group: container-mem
    included: true
    name: container_memory_failures_total
    type: counter
  - description: Current memory usage in bytes
    group: container-mem
    included: true
    name: container_memory_usage_bytes
    type: gauge
  - description: Current working set in bytes
    group: container-mem
    included: false
    name: container_memory_working_set_bytes
    type: gauge

  # Container State
  - description: Start time of the container since unix epoch in seconds.
    group: container-state
    included: false
    name: container_start_time_seconds
    type: gauge
  - description: Number of tasks in given state
    group: container-state
    included: false
    name: container_tasks_state
    type: gauge
  - description: Last time a container was seen by the exporter
    group: container-state
    included: false
    name: container_last_seen
    type: gauge

  # Pods
  - description: Cumulative count of bytes received
    group: pods
    included: true
    name: pod_network_receive_bytes_total
    type: counter
  - description: Cumulative count of errors encountered while receiving
    group: pods
    included: true
    name: pod_network_receive_errors_total
    type: counter
  - description: Cumulative count of packets dropped while receiving
    group: pods
    included: false
    name: pod_network_receive_packets_dropped_total
    type: counter
  - description: Cumulative count of packets received
    group: pods
    included: false
    name: pod_network_receive_packets_total
    type: counter
  - description: Cumulative count of bytes transmitted
    group: pods
    included: true
    name: pod_network_transmit_bytes_total
    type: counter
  - description: Cumulative count of errors encountered while transmitting
    group: pods
    included: true
    name: pod_network_transmit_errors_total
    type: counter
  - description: Cumulative count of packets dropped while transmitting
    group: pods
    included: false
    name: pod_network_transmit_packets_dropped_total
    type: counter
  - description: Cumulative count of packets transmitted
    group: pods
    included: false
    name: pod_network_transmit_packets_total
    type: counter

  # Container CPU Spec
  - description: The number of microseconds that the [CFS scheduler](https://www.kernel.org/doc/Documentation/scheduler/sched-bwc.txt)
      uses as a window when limiting container processes
    group: container-cpu-spec
    included: true
    name: container_spec_cpu_period
    type: gauge
  - description: In CPU quota for the CFS process scheduler. In K8s this is equal
      to the containers's CPU limit as a fraction of 1 core and multiplied by the
      `container_spec_cpu_period`.  So if the CPU limit is `500m` (500 millicores)
      for a container and the `container_spec_cpu_period` is set to 100,000, this
      value will be 50,000.
    group: container-cpu-spec
    included: true
    name: container_spec_cpu_quota
    type: gauge
  - description: CPU share of the container
    group: container-cpu-spec
    included: false
    name: container_spec_cpu_shares
    type: gauge

  # Container Memory Spec
  - description: Memory limit for the container.
    group: container-mem-spec
    included: true
    name: container_spec_memory_limit_bytes
    type: gauge
  - description: Memory swap limit for the container.
    group: container-mem-spec
    included: false
    name: container_spec_memory_swap_limit_bytes
    type: gauge

  # Machines
  - description: Number of CPU cores on the node.
    group: machines
    included: true
    name: machine_cpu_cores
    type: gauge
  - description: Node's CPU frequency.
    group: machines
    included: false
    name: machine_cpu_frequency_khz
    type: gauge
  - description: Amount of memory installed on the node.
    group: machines
    included: true
    name: machine_memory_bytes
    type: gauge

  monitorType: cadvisor
  properties: null
- <<: *cadvisor
  doc: |
    This monitor pulls cadvisor metrics through a
    Kubernetes kubelet instance via the `/stats/container` endpoint.
  monitorType: kubelet-stats
  properties: null
